---
layout: post
title: Phase 1 - Displaying Transcription Subtitles
description: >
  Worked with *jitsi-meet* - the front end component for [https://meet.jit.si](https://meet.jit.si).
tags: [gsoc]
---

The first phase for the GSoC 2018 is coming to an end.
Let me share my experience and contributions so far with this blog post :)

## What did I work on ?
My main task in this phase was to work on [Jitsi Meet](https://github.com/jitsi/jitsi-meet)
which is the repository containing the front-end part of the application. 

### Existing Code
One of my mentors [Nik Vaessen](https://github.com/nikvaessen) worked on
Integrating Speech to Text as a GSoC student in 2016 and 2017.

Nik made a pull request at the end of his coding period last summer for rendering
subtitles in the form of a React Component. I picked up from where Nik had left
and continued working on it.

### My Work
I worked on the `transcription` feature to enable displaying (nearly) real time transcription
subtitles conference. So, currently the subtitles can be seen as follows :

![Subtitles](/assets/img/blog/gsoc18-phase-1/subtitles.png)

I made a couple of pull requests to my mentor's fork :
- [https://github.com/nikvaessen/jitsi-meet/pull/2](https://github.com/nikvaessen/jitsi-meet/pull/2)
- [https://github.com/nikvaessen/jitsi-meet/pull/3](https://github.com/nikvaessen/jitsi-meet/pull/3)

whose changes reflect in the pull request in the main repository :<br>
[https://github.com/jitsi/jitsi-meet/pull/1914](https://github.com/jitsi/jitsi-meet/pull/1914)

### Technical aspects - How things work ?
[Jigasi](https://github.com/jitsi/jigasi) - JItsi GAteway to SIP implements a speech to text
service using [Google Cloud Speech to Text](https://cloud.google.com/speech-to-text/) and acts
like a transciber by joining the meet room as a participant which receives the audio chunks of
the participants and sends the transcribed message as the payload in a JSON format.

~~~json
{
    "transcript":[
        {
          "confidence":0.0,
          "text":"Testing Speech to Text"
        }
    ],
    "is_interim":false,
    "language":"en-US",
    "message_id":"8360900e-5fca-4d9c-baf3-6b24206dfbd7",
    "event":"SPEECH",
    "participant":{
        "name":"Praveen",
        "id":"d14c8f32"
    },
    "stability":0.0,
    "timestamp":"2017-06-24T11:04:05.637Z"
}
~~~

This payload once received by the conference, triggers an `ENDPOINT_MESSAGE_RECEIVED`
event listener which dispatches the `endpointMessageReceived` action. After this an
implemented middleware is responsible for using the payload recived to update the
subtitles. The Redux state of `features/transcription` contains a Map `transcriptionSubtitles`
of key value pairs which maps the message_id with the text.

The received `message_id` is added to the Map if it does not exist in the keys, otherwise is
updated with the stable and unstable components of the transcribed text. If it is perceived as
a final messag, then a timeout is used to dipatch a `REMOVE_TRANSCRIPT_MESSAGE` action which
removes the key,value entry from the map after a defined period.

Finally `TranscriptionSubtitles.web.js` uses this map as a Prop to re-render the transcription text
paragraphs every time it gets updated and displays it accordingly :)

### Challenges faced and Learning Outcomes
- Large Codebase : Became familiar with the codebase and the different components involved.
- Basics of XMPP : Learnt more about the XMPP standard for presence and messaging.
- React-Redux : Got familiar with the working of a react-redux applications
- Better version control : You can say that moved ahead from the *add, commit, push* philosophy ;)

## What am I currently working on ?
Currently the the transcibed message in JSON format is sent through the XMPP Message stanza 
encapsulated in its body as follows :

I am working to improve this with a packet extension in Jitsi by encapsulating the JSON body
in a `json-message` element, so that the Jigasi sends the following XMPP Stanza :
~~~xml
<message ...>
<json-message xmlns=https://www.jitsi.org/jitsi-meet>
{
  'type': 'transcription-result',
  'transcript':[
   {
     'confidence':0,
     'text':'Testing Stuff'
   }
  ],
  'is_interim':true,
  'language':'en-US',
  'message_id':'8360900e-5fca-4d9c-baf3-6b24206dfbd7',
  'event':'SPEECH',
  'participant':{
    'name':'Praveen',
    'id':'2fe3ac1c'
  },
  'stability':0.009999999776482582,
  'timestamp':'2017-08-21T14:35:46.342Z'
}
</json-message>
</message>
~~~

## Future Work
Initially we decided on going with the client-side translations but after proper research
in the available options, we decided to change it to server-side translations as :
- Lack of free services.
- Requirement of authentication for the paid ones which may lead to abuse of the service
and extra costs.

**Server-Side Translations** will be helpful as :
- It will prevent misuse of paid translation services.
- The abstract implementation will allow for easily extending it with other external translation
services as per choice and a locally setup service as well.
- Ease in preparing the final transcript of the meet in the required translated language.